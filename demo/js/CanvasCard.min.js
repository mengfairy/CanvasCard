!function(a,b){"function"==typeof define&&(define.amd||define.cmd)?define(b):a.CanvasCard=b()}(this,function(){var a=function(a){try{document.createElement("canvas").getContext("2d")}catch(b){return alert("对不起，您的浏览器不支持刮刮卡功能"),!1}return a.element&&a.bgPic&&a.upPic?document.getElementById(a.element)?(this.option=a,this.initCanvas(),void 0):!1:!1};return a.prototype={eventBind:function(){function c(a){a.preventDefault(),b=!0}function d(a){a.preventDefault(),b=!1}function e(c){var d,e;c.preventDefault(),b&&(c.changedTouches&&(c=c.changedTouches[c.changedTouches.length-1]),d=c.clientX+document.body.scrollLeft-a.canvas.offsetLeft,e=c.clientY+document.body.scrollTop-a.canvas.offsetTop,a.drawPoint(d,e))}var a=this,b=!1;a.canvas.addEventListener("touchstart",c),a.canvas.addEventListener("touchend",d),a.canvas.addEventListener("touchmove",e),a.canvas.addEventListener("mousedown",c),a.canvas.addEventListener("mouseup",d),a.canvas.addEventListener("mousemove",e),window.addEventListener("resize",function(){clearTimeout(a.time),a.time=setTimeout(a.resetCanvas.bind(a),300)},!1)},drawPoint:function(a,b){this.cxt.globalCompositeOperation="destination-out",this.cxt.beginPath();var c=this.cxt.createRadialGradient(a,b,0,a,b,30);c.addColorStop(0,"rgba(0,0,0,1)"),c.addColorStop(1,"rgba(255, 255, 255, 0)"),this.cxt.fillStyle=c,this.cxt.arc(a,b,30,0,2*Math.PI,!0),this.cxt.closePath(),this.cxt.fill()},resetCanvas:function(){var d,a=this,b=a.dom.offsetWidth,c=a.dom.offsetHeight;return b==a.width&&c==a.height?!1:(a.width=b,a.height=c,d=new Image,d.src=a.canvas.toDataURL(),a.canvas.setAttribute("width",this.width+"px"),a.canvas.setAttribute("height",this.height+"px"),d.onload=function(){a.cxt.drawImage(d,0,0,d.width,d.height,0,0,a.width,a.height)},void 0)},initCanvas:function(){var b,c,a=this;a.dom=document.getElementById(a.option.element),a.width=a.dom.offsetWidth,a.height=a.dom.offsetHeight,b=new Image,b.src=a.option.upPic,a.canvas=a.dom.getElementsByTagName("canvas")[0],a.canvas||(c=document.createElement("canvas"),a.dom.appendChild(c),a.canvas=c,a.cxt=c.getContext("2d")),a.canvas.setAttribute("width",a.width+"px"),a.canvas.setAttribute("height",a.height+"px"),a.canvas.style.backgroundImage="url('"+a.option.bgPic+"')",a.canvas.style.backgroundColor="transparent",a.canvas.style.backgroundSize="cover",a.canvas.style.backgroundRepeat="no-repeat",a.canvas.style.backgroundPosition="center",b.onload=function(){a.cxt.drawImage(b,0,0,b.width,b.height,0,0,a.width,a.height),a.eventBind()}}},a});